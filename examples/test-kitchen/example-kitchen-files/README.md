# Chef Standard Kitchen Files

This folder contains sample kitchen.yml files that adhere to the CHEF corporate standard for instance tags.  These standards are trivial to remove, extend, or override so they are included to show more complete examples.

A few of these, such as docker, dokken, and vagrant, do not require tags.  However, these are not generated by default with `chef generate cookbook`.  They may be useful for folks that do not have their own templates.

## Requirements

The templates themselves are very straight-forward; however, they do make use of environment variables to keep the templates as flexible and generic as possible.

### AWS Environment Variables

There are three env vars that need to be set for AWS:

|Variable|Value|
|--------|-----|
|AWS_SSH_KEY_NAME|Name of an _existing_ AWS key pair as it is named within AWS|
|AWS_SSH_KEY_PATH|Path to the private key for the above named key pair on the system running TK|
|AWS_REGION|Name of the AWS region that TK should use|

The easiest way to manage these is to set some sane defaults as part of your `.bash_profile` or `.zshrc`.  This way, they are automatically set each time you fire up a terminal session.  Just add the lines below with the correct values.  Save the file.  Then restart your session.

```bash
export AWS_SSH_KEY_NAME=my_aws_key
export AWS_SSH_KEY_PATH=/path/to/my/private/key
export AWS_REGION=us-west-2
```

### Azure Environment Variables

Using a text editor, open or create ~/.azure/credentials file and add the following section, noting there is one section per Subscription ID. Read the [Azure Service Principal documentation](https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli?view=azure-cli-latest) to create these credentials.

```toml
[abcd1234-YOUR-SUBSCRIPTION-ID-HERE-abcdef123456]
client_id = "abcd1234-YOUR-GUID-HERE-abcd1234abcd"
client_secret = "your-client-secret-here"
tenant_id = "GUIDY-YOUR-GUID-HERE-MCGUIDERSON"
```

There are also three env vars that need to be set for Azure:

|Variable|Value|
|--------|-----|
|AZURE_SUBSCRIPTION_ID|Subscript ID GUID for your Azure subscription|
|AZURE_SSH_KEY_PATH|Path to the private key you will be using on the system running TK|
|AZURE_LOCATION|Name of the Azure location that TK should use|

Again, the easiest way to manage these is to set some sane defaults as part of your `.bash_profile` or `.zshrc`.  This way, they are automatically set each time you fire up a terminal session.  Just add the lines below with the correct values.  Save then file.  The restart your session.

```bash
export AZURE_SUBSCRIPTION_ID=abcd1234-YOUR-SUBSCRIPTION-ID-HERE-abcdef123456
export AZURE_SSH_KEY_PATH=/path/to/my/private/key
export AZURE_LOCATION="South Central US"
```

### GCP Environment Variables

There are two env vars that need to be set for GCP:

|Variable|Value|
|--------|-----|
|GCP_PROJECT|Name of an _existing_ GCP project|
|GCP_REGION|Name of the GCP zone that TK should use|

The easiest way to manage these is to set some sane defaults as part of your `.bash_profile` or `.zshrc`.  This way, they are automatically set each time you fire up a terminal session.  Just add the lines below with the correct values.  Save the file.  Then restart your session.

```bash
export GCP_PROJECT=my-project
export GCP_REGION=us-west1
```

### SA Account Specific Environment variables

There is one environmnent variable that needs to be set to a specific value when using the SA AWS Account.

|Variable|Value|
|--------|-----|
|X_DEPT|One of "Sales", "CA", "CSE"|

This should also be set in your `.bash_profile` or `.zshrc`.

```bash
export X_DEPT=Sales
```

### Sample Complete .bash_profile

```bash
export AWS_SSH_KEY_NAME=my_aws_key
export AWS_SSH_KEY_PATH=/path/to/my/private/key
export AWS_REGION=us-west-2
export AZURE_SUBSCRIPTION_ID=abcd1234-YOUR-SUBSCRIPTION-ID-HERE-abcdef123456
export AZURE_SSH_KEY_PATH=/path/to/my/private/key
export AZURE_LOCATION="South Central US"
export GCP_PROJECT=my-project
export GCP_REGION=us-west1
export X_DEPT=Sales
```

## Docker

There are two different `kitchen` drivers that can be used with Docker, `docker` and `dokken`.  `dokken` ships with the Chef Workstation.  `docker` can be installed with a simple `chef gem install kitchen-docker`. Each of these drivers has advantages and disadvantages depending on what is being developed and what needs to be tested.

This [blog post](https://blog.chef.io/2018/03/06/kitchen-docker-or-kitchen-dokken-using-test-kitchen-and-docker-for-fast-cookbook-testing/) does an excellent job of explaining the differences between the two drivers, and the reasons you might want to use one over the other.

The post also has links to both the Docker and Dokken `kitchen` sites and their documentation.
